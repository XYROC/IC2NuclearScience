package nuclearscience.network;

import java.io.IOException;

import cpw.mods.fml.common.network.internal.FMLProxyPacket;
import cpw.mods.fml.relauncher.Side;
import io.netty.buffer.ByteBuf;
import io.netty.buffer.ByteBufInputStream;
import io.netty.buffer.ByteBufOutputStream;
import io.netty.buffer.Unpooled;
import net.minecraft.client.Minecraft;
import net.minecraft.nbt.NBTTagCompound;
import net.minecraft.tileentity.TileEntity;
import net.minecraft.world.World;
import nuclearscience.NuclearScience;
import nuclearscience.tile.TileEntityEnergyStorage;

public class Packets {

	public static final int packetTileData = 0;

	public static FMLProxyPacket createTileEnergyPacket(TileEntityEnergyStorage tile) throws IOException {
		NBTTagCompound nbt = new NBTTagCompound();
		tile.readFromNBT(nbt);
		ByteBufOutputStream bbos = new ByteBufOutputStream(Unpooled.buffer());
		bbos.writeInt(tile.xCoord);
		bbos.writeInt(tile.yCoord);
		bbos.writeInt(tile.zCoord);
		bbos.writeDouble(tile.energy);
		bbos.close();
		FMLProxyPacket packet = new FMLProxyPacket(bbos.buffer(), NuclearScience.name);
		return packet;
	}

	public static void processPacketOnClientSide(ByteBuf parBB, Side parSide) throws IOException {
		if (parSide == Side.CLIENT) {
			System.out.println("Received a Packet on the client side.");

			World world = Minecraft.getMinecraft().theWorld;
			ByteBufInputStream bbis = new ByteBufInputStream(parBB);

			int packetTypeID = bbis.readInt();

			switch (packetTypeID) {
			case packetTileData: {
				int x = bbis.readInt();
				int y = bbis.readInt();
				int z = bbis.readInt();
				double energy = bbis.readInt();
				System.out.println("Data recieved: " + x + " / " + y + " / " + z + " / " + energy);
				NBTTagCompound nbt = new NBTTagCompound();
				nbt.setDouble("energy", energy);
				TileEntity tile = world.getTileEntity(x, y, z);
				tile.readFromNBT(nbt);
			}
			}

			bbis.close();
		}
	}

}
